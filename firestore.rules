rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Only the expenses collection is readable/writable, and only by signed-in users
    match /monthlyExpense_2025/{monthId} {
      allow read, write: if isSignedIn() && isValidMonthDoc(monthId);
    }

    // Everything else denied by default
    match /{document=**} {
      allow read, write: if false;
    }

    function isSignedIn() {
      return request.auth != null;
    }

    // Basic validation for your month docs
    function isValidMonthDoc(monthId) {
      // month matches the document id, and monthIndex is an int from 1..12
      return (
        (request.method == 'create' || request.method == 'update')
          ? (
              (request.resource.data.month is string)
              && (request.resource.data.monthIndex is int)
              && (request.resource.data.monthIndex >= 1 && request.resource.data.monthIndex <= 12)
              && (request.resource.data.month == monthId)
            )
          : true
      );
    }
  }
}

